<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Bike Ledger</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#fff7ee;margin:0;padding:12px}
h2{text-align:center;margin:8px 0}

.header{
  background:#f3d3a1;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px
}
.summary{
  display:flex;
  justify-content:space-between;
  font-weight:bold
}
.summary .due{color:#c0392b}
.summary .paid{color:#1e8449}

.card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 6px rgba(0,0,0,.08)
}
.avatar{
  width:42px;height:42px;border-radius:50%;
  background:#f1c40f;
  display:flex;align-items:center;justify-content:center;
  font-weight:bold
}
.name{font-weight:bold}
.time{font-size:12px;color:#777}
.amount{font-weight:bold;color:#c0392b}

button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#333;
  color:#fff;
  font-size:15px
}

.fab{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#d32f2f;
  width:56px;
  height:56px;
  border-radius:50%;
  font-size:28px
}

input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc
}

.hidden{display:none}
</style>
</head>

<body>

<h2>üö¥ Bike Ledger</h2>

<button id="loginBtn">Google ‡¶¶‡¶ø‡ßü‡ßá Login</button>
<button id="logoutBtn" class="hidden">Logout</button>

<!-- HOME -->
<div id="home" class="hidden">
  <div class="header">
    <div class="summary">
      <div class="due">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶ì‡¶®‡¶æ<br>‡ß≥ <span id="totalDue">0</span></div>
      <div class="paid">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡ßü<br>‡ß≥ <span id="totalPaid">0</span></div>
    </div>
  </div>
  <div id="list"></div>
  <button class="fab" onclick="openAdd()">+</button>
</div>

<!-- ADD RIDE -->
<div id="add" class="hidden">
  <h3>‚ûï ‡¶≠‡¶æ‡ßú‡¶æ ‡¶Ø‡ßã‡¶ó</h3>
  <select id="passenger"></select>
  <input id="newPassenger" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶è‡¶ï‡¶¨‡¶æ‡¶∞)">
  <button onclick="addPassenger()">‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó</button>
  <input id="fare" type="number" placeholder="‡¶Æ‡ßã‡¶ü ‡¶≠‡¶æ‡ßú‡¶æ">
  <input id="paid" type="number" placeholder="‡¶è‡¶ñ‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ">
  <button onclick="saveRide()">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  <button onclick="backHome()">‚Üê Back</button>
</div>

<!-- DETAILS -->
<div id="details" class="hidden">
  <h3 id="dName"></h3>
  <div id="dTotal"></div>
  <div id="dList"></div>
  <button id="smsBtn">üì© SMS ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
  <button onclick="backHome()">‚Üê Back</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where }
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

/* üî¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCXs85Y0GzKbQqY5V3yQY-MysMl_4ABk9U",
  authDomain: "bikeledger2k.firebaseapp.com",
  projectId: "bikeledger2k",
  appId: "1:791926507922:web:d6ee8ca94a505eed4d194b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const provider = new GoogleAuthProvider();

let user=null, rides=[], passengers=[];

/* UI refs */
const home=document.getElementById("home");
const add=document.getElementById("add");
const details=document.getElementById("details");

/* LOGIN */
loginBtn.onclick=()=>signInWithPopup(auth,provider);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth, async u=>{
  if(u){
    user=u;
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    home.classList.remove("hidden");
    await loadPassengers();
    await loadRides();
    renderHome();
  }
});

/* LOAD DATA */
async function loadPassengers(){
  passengers=[];
  const snap=await getDocs(collection(db,"users",user.uid,"passengers"));
  snap.forEach(d=>passengers.push(d.data().name));
}

async function loadRides(){
  rides=[];
  const snap=await getDocs(collection(db,"users",user.uid,"rides"));
  snap.forEach(d=>rides.push(d.data()));
}

/* HOME */
function renderHome(){
  let due=0,paid=0;
  list.innerHTML="";
  rides.forEach(r=>{
    due+=r.due; paid+=r.paid;
    list.innerHTML+=`
    <div class="card" onclick="openDetails('${r.name}')">
      <div style="display:flex;gap:10px">
        <div class="avatar">${r.name[0]}</div>
        <div>
          <div class="name">${r.name}</div>
          <div class="time">${r.time}</div>
        </div>
      </div>
      <div class="amount">‡ß≥ ${r.due}</div>
    </div>`;
  });
  totalDue.innerText=due;
  totalPaid.innerText=paid;
}

/* ADD */
window.openAdd=()=>{
  home.classList.add("hidden");
  add.classList.remove("hidden");
  passenger.innerHTML='<option value="">‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</option>';
  passengers.forEach(p=>passenger.innerHTML+=`<option>${p}</option>`);
};

window.addPassenger=async()=>{
  const n=newPassenger.value;
  if(!n) return;
  await addDoc(collection(db,"users",user.uid,"passengers"),{name:n});
  newPassenger.value="";
  loadPassengers();
};

window.saveRide=async()=>{
  const name=passenger.value;
  const fare=+document.getElementById("fare").value;
  const paid=+document.getElementById("paid").value;
  if(!name||!fare) return alert("‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡¶ø‡¶®");
  await addDoc(collection(db,"users",user.uid,"rides"),{
    name,fare,paid,due:fare-paid,time:new Date().toLocaleString()
  });
  backHome();
  await loadRides();
  renderHome();
};

/* DETAILS */
window.openDetails=(name)=>{
  home.classList.add("hidden");
  details.classList.remove("hidden");
  dName.innerText=name;
  const list2=rides.filter(r=>r.name===name);
  let total=0;
  dList.innerHTML="";
  list2.forEach(r=>{
    total+=r.due;
    dList.innerHTML+=`<div>${r.time} ‚Äî ‡¶¨‡¶æ‡¶ï‡¶ø ‡ß≥${r.due}</div>`;
  });
  dTotal.innerHTML=`‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø: ‡ß≥ ${total}`;
  smsBtn.href=`sms:?body=‡¶™‡ßç‡¶∞‡¶ø‡ßü ${name}, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶≠‡¶æ‡ßú‡¶æ ${total} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§`;
};

/* BACK */
window.backHome=()=>{
  add.classList.add("hidden");
  details.classList.add("hidden");
  home.classList.remove("hidden");
};
</script>

</body>
</html>
